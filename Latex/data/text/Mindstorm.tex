Cette partie décrit l'implémentation de l'algorithme EKF sur la brique EV3. Il y est également présenté un algorithme qui utilise la position du robot pour construire une grille d'occupation.  Cette grille d'occupation sert à construire un graphe qui permet de trouver un chemin entre un point de départ et un point d'arrivée de la carte. En plus de ces descriptions d'algorithmes, cette partie aide le lecteur qui souhaite développer un algorithme sur son propre robot. Une description de la brique EV3, de ses capteurs et des possibilités de programmation qu'offre la brique EV3 est donnée pour aider ce lecteur dans cette aventure. De plus, des conseils sur la construction du robot sont également donnés pour permettre au développeur de construire un bon châssis pour son robot. Finalement, des alternatives à la brique EV3 sont données. En effet, cette brique est relativement couteuse et elle ne répond pas toujours au besoin du développeur. C'est pourquoi cette partie contient une présentation de quelques simulateurs en robotique ainsi que la présentation des microcontrôleurs Arduino et Raspberry Pi.   


\chapter{Lego Mindstorms}
Les Legos sont des jouets de construction fabriqués par le groupe danois «~The Lego Group~». La série Mindstorms correspond à la gamme «~robotique programmable~» de Legos. Cette série est vendue en kits qui permettent de réaliser certains modèles de robots prédéfinis et par la suite de laisser cours à son imagination. Les kits contiennent une brique intelligente programmable, un ensemble de capteurs et de moteurs ainsi qu'un ensemble d'éléments de construction qui proviennent de la gamme Lego Technic. Ces kits permettent de réaliser rapidement et à couts modérés des robots simples. Ils se sont donc vite révélés comme des outils intéressants pour l'apprentissage de la robotique et de la programmation.

\section{Description du hardware}
Le kit Lego peut être comparé à des packs composés de microcontrôleurs Arduino\footnote{Arduino : \href{https://www.arduino.cc}{www.arduino.cc} } ou Raspberry Pi\footnote{Raspberry Pi : \href{https://www.raspberrypi.org}{www.raspberrypi.org}  } et d'une série de capteurs et de moteurs. Les microcontrôleurs Arduino et Raspberry Pi possèdent l'avantage de pouvoir utiliser une plus grande gamme des capteurs et moteurs à moindres couts. Cependant, la mise en place de ces capteurs se révèle de plus bas niveau et donc plus longue. Contrairement au kit Lego où les moteurs et capteurs sont de type «~plug and play~». Ce projet est plus basé sur les aspects de programmation en robotique que sur les aspects hardware, c'est pourquoi le kit Lego Mindstorms a été favorisé. 


\subsection{Brique intelligente}
La brique intelligente programmable (voir Figure~\ref{EV3}) est le cerveau des robots EV3. Elle est dotée d'une interface à six boutons lumineux qui changent de couleur pour indiquer l'état d'activité de la brique, d'un affichage à haute résolution noir et blanc, d'un hautparleur intégré, d'un port USB, d'un lecteur de cartes mini SD, de quatre ports d'entrée et de quatre ports de sortie. La brique prend également en charge la communication USB, Bluetooth et Wifi avec un ordinateur. Son interface programmable permet à la fois de programmer et de journaliser des données directement sur la brique. Elle est compatible avec les appareils mobiles et est alimentée par des piles AA ou par la batterie CC rechargeable EV3. La brique EV3 fournit l'énergie pour les capteurs et les moteurs. Elle permet de récupérer et de traiter les informations des capteurs et d'envoyer des commandes aux moteurs par l'intermédiaire des ports d'entrée et de sortie. Ce qui rend la connexion et l'utilisation des capteurs et des moteurs très facile.

\begin{figure}
\begin{center}
\includegraphics[scale = 0.7]{./../img/EV3.png}
\caption{Brique EV3}
\source{ \href{http://www.4erevolution.com/lego-mindstorm-ev3-hacking/}{www.4erevolution.com}}
\end{center}

\label{EV3}
\end{figure}


Depuis son lancement, la gamme de Lego Mindstorms a connu trois types de briques qui se sont succédés :  la brique RXC, NXT et EV3. Elles ont progressivement augmenté de puissance de calcul. La vraie révolution de la brique EV3 est la possibilité de booter le système depuis la carte SD. Ce qui augmente ainsi le potentiel de la brique (comme décrit dans la section~\ref{sec:DesSoftware}). 

La brique EV3 embarque un processeur arm9, 16Mo de mémoire flash et 64Mo de RAM. La carte SD permet d'étendre la mémoire à 32Go. Il est vrai que la puissance a augmenté dans la brique EV3 en comparaison avec ses prédécesseurs. Toutefois, cette puissance de calcul reste réduite en comparaison aux ordinateurs et smartphones actuels. 
\subsection{Moteurs et capteurs}
Le pack de base de la brique EV3 est composé de deux moteurs moyens, un petit moteur, un capteur de pression, un capteur de distance infrarouge et d'un capteur de couleurs. Il est possible d'acheter des capteurs Legos supplémentaires tels qu'un gyroscope, un capteur de distance ultrasonique et une boussole. Il est également possible d'acheter d'autres types de capteurs développés par des sociétés indépendantes de Lego. C'est possible grâce au support de protocoles standards que doivent adopter les capteurs de données. On peut par exemple citer $I^2C$ qui est un bus de données conçu par Philips et qui est très répandu dans le monde de l'électronique. On voit donc en vente des capteurs GPS, des capteurs RFID ou encore des capteurs d'humidité qui sont compatibles avec la brique EV3

La partie qui suit décrit plus en profondeur les capteurs et moteurs du kit de base qui sont ceux disponibles pour réaliser ce projet. Les descriptions sont basées sur les informations données par le constructeur. Les descriptions sont dirigées vers le type de données reçues ainsi que la précision des capteurs et des moteurs. Ces descriptions sont importantes dans ce mémoire, car elles permettent de mieux connaitre les capteurs et les moteurs à notre disposition. Il est ainsi plus facile de définir les erreurs qui sont propres à ces capteurs.

Le capteur infrarouge EV3 détecte la proximité d'objets (jusqu'à 70 cm) et lit les signaux émis par la balise infrarouge EV3 (distance max de 2m). Les utilisateurs peuvent créer des robots télécommandés, faire des courses d'obstacles et se familiariser avec l'utilisation de la technologie infrarouge. Cette technologie est présente dans les télécommandes des TV et les systèmes de surveillance.

Le capteur de couleur numérique EV3 différencie huit couleurs. Il peut être utilisé aussi comme capteur photosensible en mesurant l'intensité lumineuse. Les utilisateurs peuvent construire des robots qui trient selon les couleurs ou suivent une ligne, expérimenter la réflexion de la lumière de différentes couleurs et se familiariser avec une technologie largement répandue dans les secteurs industriels du recyclage, de l'agriculture et de l'emballage. 

Le capteur tactile analogique EV3 est un outil simple, mais extrêmement précis, capable de détecter tous les pressions ou les relâchements de son bouton frontal. Les utilisateurs pourront construire des systèmes de commande marche/arrêt, créer des robots capables de s'extraire d'un labyrinthe et découvrir l'utilisation de cette technologie dans des appareils tels que les instruments de musique numériques, les claviers d'ordinateur ou l'électroménager.

Le grand servomoteur EV3 est un puissant moteur avec retour tachymétrique pour un contrôle précis au degré près. Grâce à son capteur de rotation intégré, ce moteur intelligent peut être synchronisé avec les autres moteurs d'un robot pour rouler en ligne droite à la même vitesse. Il peut également être utilisé pour fournir une mesure précise pour des expériences. Par ailleurs, la forme du boitier facilite l'assemblage des trains d'engrenage.

Le servomoteur moyen EV3 est parfait pour des charges moins importantes, des applications à vitesse plus élevée, ainsi que des situations où une plus grande réactivité et un plus petit profil sont nécessaires lors de la conception du robot. Le moteur se sert d'un retour tachymétrique pour un contrôle précis au degré près et il possède un capteur de rotation intégré.

\subsection{Simulateurs}
 Pour les personnes qui ne souhaitent pas acheter de matériels ou pour des tests à plus grande échelle, il est possible d'utiliser des simulateurs. Un simulateur comme Gazebo \footnote{Gazebo : \href{http://gazebosim.org/}{gazebosim.org}} permet d'utiliser ou de construire des modèles de robots qui évoluent dans un environnement prédéfini. Ce projet open source  a reçu des financements de la DRC\footnote{DRC : \href{http://www.theroboticschallenge.org/}{www.theroboticschallenge.org}} pour l'adaptation du simulateur à son robot ATLAS. Cependant, ce type de simulateur nécessite un temps d'apprentissage certain pour pouvoir commencer à l'utiliser. C'est pourquoi d'autres simulateurs plus simples de la brique de Lego existent. L'université de Berne a développé EV3JLIB\footnote{EV3JLIB : \href{http://www.aplu.ch/home/apluhomex.jsp?site=145}{www.aplu.ch}} qui permet de lancer gratuitement un simulateur en ligne. Le comportement du robot est codé en Java. Ce code a l'avantage d'être réutilisable sur la brique. D'autres logiciels destinés à l'apprentissage de la robotique à l'aide d'un simulateur de la brique EV3 et plus évolués graphiquement que EV3JLIB sont disponibles en ligne. Les deux principaux sont «~virtual robotics toolkit~» \footnote{Virtual robotics toolkit :  \href{https://cogmation.com/virtual-robotics-toolkit}{cogmation.com} } et   «~Robot virtual worlds~» \footnote{Robot virtual worlds : \href{http://www.robotvirtualworlds.com/virtualbrick/}{www.robotvirtualworlds.com}} mais ils sont payants.

\section{Description du software } 
\subsection{RoboLab}
\label{sec:DesSoftware}
C'est dans la brique EV3 qu'il est possible d'injecter un programme contenant les instructions du robot. Lego fournit un langage de programmation graphique qui s'appelle RoboLab (voir~\ref{Robolab}). Ce langage de programmation est constitué d'un ensemble de briques. Il est possible de les assembler pour définir le mini programme qui définit le comportement du robot. Les briques permettent de définir des actions sur les moteurs, afficher des messages sur l'écran de la brique EV3, jouer des sons. Il est également possible de définir des conditions à l'aide des valeurs obtenues par les capteurs et même de lancer des boucles. Il est le fruit de la collaboration de Lego avec le M.I.T.. Il se révèle un bon langage de programmation pour l'apprentissage de la programmation. Cependant, il n'est pas approprié au développement d'algorithmes complexes de localisation comme EKF ou bien MCL. Les briques Mindstorm ont vite été hackées pour permettre de développer des programmes à l'aide d'autres langages que RoboLab. Dans la version EV3, il est possible de booter sur une carte SD. Ce qui a permis que des OS tels que Linux soient adaptés pour fonctionner sur la brique. Le projet ev3Dev est un exemple d'adaptation de Debian GNU/Linux pour la brique EV3. Il est donc maintenant potentiellement possible de développer à l'aide de tous les langages disponibles sur Linux. Lejos est une API écrite en Java comme le laisse supposer son nom. Lejos est l'outil principalement utilisé dans ce mémoire, une description plus complète en est donc donnée dans une section dédiée.

\begin{figure}
\begin{center}
\includegraphics[scale=0.7]{./../img/Robolab.png}
\caption{Robolab}
\source{\href{http://www.lego.com/en-us/mindstorms/}{www.lego.com}}
\end{center}
\label{Robolab}
\end{figure}



\subsection{Lejos}
Lejos est un microprogramme libre destiné à remplacer le microprogramme originalement installé sur la brique Lego Mindstorm. Il est disponible sur les briques RCX, NXT et EV3. Lejos inclut une machine virtuelle Java permettant de développer des robots dans le langage Java. La machine virtuelle Java a donné le nom Lejos qui est le mot Legos où le «~g~» a été remplacé par un «~j~» pour Java. Pour la version EV3 de la brique Lego, cette machine virtuelle Java est mise à disposition par Oracle. Lejos permet un accès facile aux moteurs et aux capteurs. Ce qui est possible grâce aux routines écrites en c et mise dans le domaine public par le groupe Lego. En effet, Lego à décider de publier le code source de la brique EV3 en open source. Ces routines en c permettent en théorie d'utiliser n'importe quel langage de programmation pour développer des comportements de robots. 

Depuis son lancement jusqu'à aujourd'hui, Lejos dispose d'une communauté active et de taille assez importante. Le dépôt officiel du code source est sourceforge.net. Entre le 01-01-2015 et le 09-04-2015, la version 0.9.0-beta de la brique EV3 a été téléchargée 2700 fois. En effet, l'outil Lejos est couramment utilisé dans les universités et dans les hautes écoles pour l'apprentissage de la robotique et du langage Java. L'implémentation orientée objet permet aux étudiants d'étudier la robotique avec le niveau d'abstraction qu'ils désirent. Il est ainsi possible de développer des algorithmes de localisation sans se soucier des adresses hexadécimales des moteurs et des capteurs. 

Lejos est également utilisé dans la recherche. De nombreux projets ont déjà vu le jour. Des chercheurs de l'université de Porto au Portugal ont déjà utilisé Lejos pour implémenter un algorithme  qui cartographie l'environnement d'un robot~\cite{OliveiraLejos}. Encore à l'université de Porto un simulateur simple et des exercices d'utilisation de l'algorithme EKF ont été développés\footnote{ EKF : \href{http://paginas.fe.up.pt/~robosoc/en/doku.php?id=start_lego}{paginas.fe.up.pt/~robosoc}} par les professeurs de l'université de Porto. Un étudiant suédois a développé un SLAM\footnote{ SLAM : \href{http://penemunxt.blogspot.be/}{penemunxt.blogspot.be}} et des outils de visualisation de la carte et de la position du robot. Finalement, un projet qui permet de définir le comportement d'un robot à l'aide de diagramme d'état est disponible sur github\footnote{ Diagramme d'états : \href{https://github.com/jabrena/liverobots}{github.com/jabrena/liverobots}}. L'ensemble de ces projets prouve que Lejos possède de bonnes bases pour développer des algorithmes complexes. 

\section{Description du robot construit}
La plateforme du robot construit est de type «~differential wheeled robot~»(voir~\ref{DWR}). Ce qui consiste en deux moteurs indépendants positionnés de façon opposée sur le robot. En plus de ses deux roues, une roue libre est placée à l'arrière. Il est conseillé de ne pas placer cette roue libre au centre de l'axe de rotation vertical de celle-ci pour créer un levier qui garantit une meilleure rotation de cette roue libre. Ce choix de plateforme est commun en robotique. Cette plateforme est simple à mettre en oeuvre et fournit une amplitude de mouvement importante. A l'inverse les plateformes «~steering~» sont semblables aux voitures classiques. Elles demandent un mécanisme plus complexe et leur amplitude de mouvement est moindre et donc moins adaptée à la robotique.

\begin{figure}
\begin{center}
\includegraphics{./../img/DifferentialWheeledRobot.png}
\caption{Differential wheeled robot }
\source{\href{https://en.wikipedia.org/wiki/Differential_wheeled_robot}{Wikipedia},
 Auteur : Patrik}
 \label{DWR}
\end{center}

\end{figure}

La figure~\ref{Robot} présente le robot qui a été construit pour réaliser l'implémentation et tester les algorithmes présentés dans ce mémoire. Le robot est composé d'un capteur de pression. Il n'est pas possible de déterminer la localisation d'une pression sur le pare-chocs avant. La pression est identifiée indifféremment que ce soit le côté gauche ou le côté droit du pare-chocs qui a été touché. Il est également équipé d'un capteur de distance infrarouge sur sa face avant. Un support est placé sur le haut du robot pour accueillir le smartphone qui s'occupe de scanner les codes QR qui sont les points de repère du robot dans l'algorithme EKF. Pour permettre à la brique EV3 de communiquer de façon efficace avec le smartphone et l'ordinateur un stick USB wifi a été ajouté à la brique EV3. La communication avec l'ordinateur doit être efficace pour permettre que les données captées par les capteurs de la brique EV3 soient rapidement envoyées à l'ordinateur et inversement pour que les commandes envoyées par l'ordinateur arrivent rapidement sur la brique EV3.

La construction de la plateforme de déplacement et l'ajout des capteurs sur le robot sont des étapes à ne pas négliger. Elle est relativement longue pour avoir un robot utilisable. En effet, il est important de positionner les capteurs et les moteurs à des endroits réfléchis. Il est par exemple primordial de ne pas placer des éléments de la plateforme devant le capteur de distance. Le pare-chocs muni du capteur de pression doit être construit de façon à bien réagir à tous les types de chocs. L'ensemble des câbles doit être introduit dans les ports appropriés de la brique EV3 sans entraver le fonctionnement des moteurs ou des capteurs. Finalement, certaines propriétés du robot permettent de simplifier leur manipulation et les algorithmes qui sont implémentés pour les manipuler. Il est par exemple plus simple de manipuler un robot avec un châssis arrondi et capable de faire un demi-tour sur lui-même. Il est possible à l'aide d'un châssis arrondi de faire facilement un demi-tour sur soi-même dans un angle d'un mur sans le percuter. Alors qu'un châssis de type rectangulaire a tendance à se bloquer l'or de la rotation pour faire le demi-tour. En effet, les coins du robot ont tendance à percuter le mur. Dans le cas d'un robot rectangulaire, les algorithmes de mouvement doivent prendre en compte les particularités de la forme du robot pour éviter de percuter des objets. L'ensemble des contraintes de construction des robots rend compliquée la construction d'un robot. Il est donc possible de trouver sur le web des exemples de plateformes qui ont fait leurs preuves. Le site nxtprograms \footnote{ nxtprograms : \href{http://www.nxtprograms.com/index2.html}{www.nxtprograms.com}} propose une série d'exemples de plateformes évolutives.  



\begin{figure}
\begin{center}
\includegraphics[scale=0.7]{./../img/EV3Robot.png}
\caption{Robot }
\label{Robot}
\end{center}
\end{figure}



 
