\chapter{Lego Mindstorms}
Les Legos sont des jouets de construction fabriqués par le groupe danois «the Lego Group». La série Mindstorms correspond à la gamme « robotique programmable » de Legos. Cette série est vendue en kits qui permettent de réaliser certains modèles de robots prédéfinis et par la suite de laisser cours à son imagination. Les kits contiennent une brique intelligente programmable, un ensemble de capteurs et de moteurs ainsi qu'un ensemble d'éléments de constructions qui proviennent de la gamme Lego Technic. Ces kits permettent de réaliser rapidement et à couts modérés des robots simples. Ils se sont donc vite révélés comme des outils intéressants pour l'apprentissage de la robotique et de la programmation.

\section{Description du hardware  }
Le kit Lego peut être comparé à des packs composés de microcontrôleurs Arduino\footnote{Arduino : \href{https://www.arduino.cc}{www.arduino.cc} } ou Raspberry Pi\footnote{Raspberry Pi : \href{https://www.raspberrypi.org}{www.raspberrypi.org}  } et d'une série de capteurs et de moteurs. Le microcontrôleur Arduino et Raspberry Pi possède l'avantage de pouvoir utiliser une plus grande gamme des capteurs et moteurs à moindres couts. Cependant, la mise en place de ces capteurs se révèle de plus bas niveau et donc plus longue. Contrairement au kit Lego où les moteurs et capteurs sont de type «plug and play». Ce projet est plus basé sur les aspects de programmation en robotique que sur les aspects hardware, c'est pourquoi le kit Lego Mindstorms a été favorisé. 


\subsection{Brique intelligente}
La brique intelligente programmable (voir Figure ~\ref{EV3} ) est le cerveau des robots EV3. Elle est dotée d'une interface à six boutons lumineux qui changent de couleur pour indiquer l'état d'activité de la brique, d'un affichage à haute résolution noir et blanc, d'un hautparleur intégré, d'un port USB, d'un lecteur de cartes mini SD, de quatre ports d'entrée et de quatre ports de sortie. La brique prend également en charge la communication USB, Bluetooth et Wifi avec un ordinateur. Son interface programmable permet à la fois de programmer et de journaliser des données directement sur la brique. Elle est compatible avec les appareils mobiles et est alimentée par des piles AA ou par la batterie CC rechargeable EV3. La brique EV3 fournit l'énergie pour les capteurs et les moteurs. Elle permet de récupérer et de traiter les informations des capteurs et d'envoyer des commandes aux moteurs par le biais des ports d'entrée et de sortie. Ce qui rend la connexion et l'utilisation des capteurs et des moteurs très facile.

\begin{figure}
\begin{center}
\includegraphics[scale = 0.7]{./../img/EV3.png}
\caption{Brique EV3}
\source{ \href{http://www.4erevolution.com/lego-mindstorm-ev3-hacking/}{www.4erevolution.com}}
\end{center}

\label{EV3}
\end{figure}


Depuis son lancement la gamme de Lego Mindstorms a connu trois types de briques qui se sont succédé, la brique RXC, NXT et EV3. Elles ont progressivement augmenté de puissance de calcul. La vraie révolution de la brique EV3 est la possibilité de booter le système sur une carte SD. Ce qui augmente ainsi le potentiel de la brique (comme décrit dans la section ~\ref{sec:DesSoftware}). 

La brique EV3 embarque un processeur arm9, 16Mo de mémoire flash et 64Mo de RAM. La carte SD permet d'étendre la mémoire à 32Go. Il est vrai que la puissance a augmenté dans la brique EV3 en comparaison avec ses prédécesseurs. Toutefois, cette puissance de calcul reste réduite en comparaison aux ordinateurs et smartphones actuels. 
\subsection{Moteurs et capteurs}
Le pack de base de la bique EV3 est composé de deux moteurs moyens, un petit moteur, un capteur de pression, un capteur de distance infrarouge et d'un capteur de couleurs. Il est possible d'acheter des capteurs Legos supplémentaires tels qu'un gyroscope, un capteur de distance ultrasonique et une boussole. Il est également possible d'acheter d'autre type de capteurs développés par des sociétés indépendantes de Lego. C'est possible grâce au support de protocole standard que doivent adopter les capteurs de données. On peut par exemple citer $I^2C$ qui est un bus de données conçu par Philips et qui est très répandu dans le monde de l'électronique. On voit donc en vente des capteurs GPS, des capteurs RFID, des capteurs d'humidité qui sont compatible avec la brique EV3

La partie qui suit décrit plus en profondeur les capteurs et moteurs du kit de base qui sont ceux disponibles pour réaliser ce projet. Les descriptions sont basées sur les informations données par le constructeur. Les descriptions sont dirigées vers le type de données reçues ainsi que la précision des capteurs et des moteurs. Ces descriptions sont importantes dans ce mémoire, car elles permettent de mieux connaitre les capteurs et les moteurs à notre disposition ce qui permet ainsi de mieux définir les erreurs qui sont propres à ces capteurs.

Le capteur infrarouge EV3 détecte la proximité d'objets (jusqu'à 70 cm) et lit les signaux émis par la balise infrarouge EV3 (distance max de 2m ). Les utilisateurs peuvent créer des robots télécommandés, faire des courses d'obstacles et se familiariser avec l'utilisation de la technologie infrarouge dont les télécommandes des TV, les systèmes de surveillance.

Le capteur de couleur numérique EV3 différencie huit couleurs. Il peut être utilisé aussi comme capteur photosensible en mesurant l'intensité lumineuse. Les utilisateurs peuvent construire des robots qui trient selon les couleurs ou suivent une ligne, expérimenter la réflexion de la lumière de différentes couleurs et se familiariser avec une technologie largement répandue dans les secteurs industriels du recyclage, de l'agriculture et de l'emballage. 

Le capteur tactile analogique EV3 est un outil simple, mais extrêmement précis, capable de détecter toute pression ou relâchement de son bouton frontal. Les utilisateurs pourront construire des systèmes de commande marche/arrêt, créer des robots capables de s'extraire d'un labyrinthe et découvrir l'utilisation de cette technologie dans des appareils tels que les instruments de musique numériques, les claviers d'ordinateur ou l'électroménager.

Le grand servomoteur EV3 est un puissant moteur avec retour tachymétrique pour un contrôle précis au degré près. Grâce à son capteur de rotation intégré, ce moteur intelligent peut être synchronisé avec les autres moteurs d'un robot pour rouler en ligne droite à la même vitesse. Il peut également être utilisé pour fournir une mesure précise pour des expériences. Par ailleurs, la forme du boitier facilite l'assemblage des trains d'engrenage.

Le servomoteur moyen EV3 est parfait pour des charges moins importantes, des applications à vitesse plus élevée, ainsi que des situations où une plus grande réactivité et un plus petit profil sont nécessaires lors de la conception du robot. Le moteur se sert d'un retour tachymétrique pour un contrôle précis au degré près et possède un capteur de rotation intégré.

\section{Description du software } 
\label{sec:DesSoftware}
C'est dans la brique EV3 qu'il est possible d'injecter un programme contenant les instructions du robot. Lego fournit un langage de programmation graphique qui s'appelle RoboLab(voir ~\ref{Robolab}). Il est le fruit de la collaboration de Lego avec le M.I.T.. Il se révèle un bon langage de programmation pour l'apprentissage de la programmation. Cependant, il n'est pas approprié au développement d'algorithme complexe de localisation comme EKF ou bien MCL. Les briques Mindstorm ont vite été hackées pour permettre de développer des programmes à l'aide d'autre langage que RoboLab. Dans la version EV3, il est possible de booter sur une carte SD. Ce qui a permis que des OS tels que Linux soient adaptés pour fonctionner sur la brique. Le projet ev3Dev est un exemple d'adaptation de Linux pour la brique EV3. Il est donc maintenant potentiellement possible de développer à l'aide de tous les langages disponibles sur Linux. Lejos est une API écrite en Java comme le laisse supposer son nom. Lejos est l'outil principalement utilisé dans ce mémoire, une description plus complète est donc donnée dans une section dédiée.

\begin{figure}
\begin{center}
\includegraphics[scale=0.7]{./../img/Robolab.png}
\caption{Robolab}
\source{\href{http://www.lego.com/en-us/mindstorms/}{www.lego.com}}
\end{center}
\label{Robolab}
\end{figure}

\section{Simulateurs}
 Pour les personnes qui ne souhaitent pas acheter de matériels ou pour des tests à plus grande échelle, il est possible d'utiliser des simulateurs. Un simulateur comme Gazebo \footnote{Gazebo : \href{http://gazebosim.org/}{gazebosim.org}} permet d'utiliser ou de construire des modèles de robots qui évoluent dans un environnement prédéfini. Ce projet open source  à reçu des financements de la DRC\footnote{DRC : \href{http://www.theroboticschallenge.org/}{www.theroboticschallenge.org}} pour l'adaptation à son robot ATLAS. Cependant, ce type de simulateur nécessite un temps d'apprentissage certain pour pouvoir commencer à l'utiliser. C'est pourquoi d'autres simulateurs plus simples de la brique de Lego existent. L'université de Berne a développé EV3JLIB\footnote{EV3JLIB : \href{http://www.aplu.ch/home/apluhomex.jsp?site=145}{www.aplu.ch}} qui permet de lancer gratuitement un simulateur en ligne avec le comportement du robot codé en Java. Ce code à l'avantage d'être réutilisable sur la brique. D'autres logiciels destinés à l'apprentissage de la robotique à l'aide d'un simulateur de la brique EV3 et plus évolués graphiquement que EV3JLIB sont disponibles en ligne. Les deux principaux sont «virtual robotics toolkit» \footnote{Virtual robotics toolkit :  \href{https://cogmation.com/virtual-robotics-toolkit}{cogmation.com} }et   «Robot virtual worlds» \footnote{Robot virtual worlds : \href{http://www.robotvirtualworlds.com/virtualbrick/}{www.robotvirtualworlds.com}} mais ils sont payants.

\section{Lejos}
Lejos est un microprogramme libre destiné à remplacer le microprogramme originalement installé sur la brique Lego Mindstorm. Il est disponible sur les briques RCX, NXT et EV3. Lejos inclut une machine virtuelle Java permettant de développer des robots dans le langage Java. Ce qui a donné le nom Lejos qui est le mot Legos où le « g » a été remplacé par un « j » pour Java. Pour la version EV3 de la brique Lego, cette machine virtuelle Java est mise à disposition par Oracle. Lejos permet un accès facile aux moteurs et aux capteurs. Ce qui est possible grâce aux routines écrites en c et mise dans le domaine public par le groupe Lego. En effet, Lego à décider de publier le code source de la brique EV3 en open source. Ces routines en c permettent en théorie d'utiliser n'importe quel langage de programmation pour développer des comportements de robots. 

Depuis son lancement jusqu'à aujourd'hui Lejos dispose d'une communauté active et de taille assez importante. Le dépôt officiel du code source est sourceforge.net. Entre le 01-01-2015 et le 09-04-2015 la version 0.9.0-beta de la brique EV3 a été téléchargée 2700 fois. En effet, l'outil Lejos est couramment utilisé dans les universités et dans les hautes écoles pour l'apprentissage de la robotique et du langage Java. L'implémentation orientée objet permet aux étudiants d'étudier la robotique avec le niveau d'abstraction qu'ils désirent. Il est ainsi possible de développer des algorithmes de localisation sans se soucier des adresses hexadécimales des moteurs et des capteurs. 

Lejos est également utilisé dans la recherche. De nombreux projets ont déjà vu le jour. Des chercheurs de l'université de Porto au Portugal ont déjà utilisé Lejos pour implémenter un algorithme  qui cartographie l'environnement d'un robot \cite{OliveiraLejos}. Encore à l'université de Porto un simulateur simple et des exercices d'utilisation de l'algorithme EKF ont été développés\footnote{ EKF : \href{http://paginas.fe.up.pt/~robosoc/en/doku.php?id=start_lego}{paginas.fe.up.pt/~robosoc}} par les professeurs de l'université de Porto. Un étudiant suédois a développé un Slam\footnote{ Slam : \href{http://penemunxt.blogspot.be/}{penemunxt.blogspot.be}} et des outils de visualisation de la carte et de la position du robot. Finalement, un projet qui permet de définir le comportement d'un robot à l'aide de diagramme d'état est disponible sur github\footnote{ Diagramme d'états : \href{https://github.com/jabrena/liverobots}{github.com/jabrena/liverobots}}. L'ensemble de ses projets prouve que Lejos possède de bonnes bases pour développer des algorithmes complexes. 
\subsection{MCL }
Lejos fournit dans sa librairie une implémentation de l'algorithme MCL. Dans cette implémentation les données de mesures proviennent d'un capteur de distance.   
